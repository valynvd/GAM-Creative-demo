<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Newstag Preview</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background:#fafafa; }
  .tag-container { display:flex; gap:8px; flex-wrap:wrap; margin-top:16px; }
  .tag { background:#f2f2f2; padding:6px 12px; border-radius:14px; font-size:14px; border:1px solid #dcdcdc; }
  .tag.active { background:#fff4cc; border-color:#e0b100; font-weight:bold; }
</style>
</head>

<body>

<div class="tag-container" id="tagContainer">
  <div class="tag">Sample</div>
  <div class="tag">Sample</div>
  <div class="tag">Sample</div>
  <div class="tag">Sample</div>
  <div class="tag">Sample</div>
</div>

<script>
  const text = "{{ text }}";
  const pos = parseInt("{{ position }}", 10) || 0;
  const container = document.getElementById("tagContainer");

  const newTag = document.createElement("div");
  newTag.className = "tag active";
  newTag.textContent = text;

  const children = container.children;
  if (pos >= children.length) container.appendChild(newTag);
  else container.insertBefore(newTag, children[pos]);
</script>

{% if snippet %}
<script>
(function() {
  const htmlString = `{{ snippet | safe }}`;
  const parser = new DOMParser();
  const parsed = parser.parseFromString(htmlString, "text/html");

  parsed.querySelectorAll("script").forEach(s => {
    const sc = document.createElement("script");
    if (s.src) sc.src = s.src;
    else sc.textContent = s.textContent;
    document.body.appendChild(sc);
  });
})();
</script>
{% endif %}

</body>
</html>
